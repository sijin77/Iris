# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –•—Ä–∞–Ω–∏–ª–∏—â

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  RelationalStorage  ‚îÇ  VectorStorage  ‚îÇ  ChatMemoryStorage  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  SQLiteStorageFactory  ‚îÇ  ChromaStorageFactory  ‚îÇ  ...      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –§–∞–±—Ä–∏–∫–∞                       ‚îÇ
‚îÇ              UniversalStorageFactory                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 StorageManager (Singleton)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢–µ–∫—É—â–∏–µ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –ë–î
- ‚úÖ **SQLite** - `SQLiteStorageFactory`
- üîÑ **PostgreSQL** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)
- üîÑ **MySQL** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)

### –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –ë–î
- ‚úÖ **ChromaDB** - `ChromaStorageFactory`
- üîÑ **Weaviate** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)
- üîÑ **Pinecone** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)
- üîÑ **Qdrant** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)

### –ü–∞–º—è—Ç—å
- ‚úÖ **SQLite** - `SQLiteStorageFactory`
- üîÑ **Redis** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)
- üîÑ **PostgreSQL** - –∑–∞–≥–æ—Ç–æ–≤–∫–∞ (TODO)

## –ó–∞–º–µ–Ω–∞ –ë–î

### 1. –ó–∞–º–µ–Ω–∞ SQLite –Ω–∞ PostgreSQL

#### –®–∞–≥ 1: –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å PostgreSQL –≤ docker-compose.yml
```yaml
postgres:
  image: postgres:15
  environment:
    POSTGRES_DB: iriska
    POSTGRES_USER: iriska
    POSTGRES_PASSWORD: iriska123
  volumes:
    - postgres_data:/var/lib/postgresql/data
  ports:
    - "5432:5432"
  networks:
    - iriska-network
```

#### –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```yaml
environment:
  DB_TYPE: "postgresql"
  MEMORY_DB_URL: "postgresql://iriska:iriska123@postgres:5432/iriska"
  MEMORY_TYPE: "postgresql"
```

#### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å PostgreSQL —Ñ–∞–±—Ä–∏–∫—É
```python
# src/agent/storage/postgresql_storage.py
class PostgreSQLStorageFactory:
    @staticmethod
    def create_relational_storage(config: StorageConfig) -> RelationalStorage:
        return PostgreSQLRelationalStorage(config)
```

### 2. –ó–∞–º–µ–Ω–∞ ChromaDB –Ω–∞ Weaviate

#### –®–∞–≥ 1: –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Weaviate –≤ docker-compose.yml
```yaml
weaviate:
  image: semitechnologies/weaviate:1.22.4
  ports:
    - "8080:8080"
  environment:
    AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: 'true'
    DEFAULT_VECTORIZER_MODULE: 'none'
  networks:
    - iriska-network
```

#### –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```yaml
environment:
  VECTOR_TYPE: "weaviate"
  VECTOR_URL: "http://weaviate:8080"
```

#### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å Weaviate —Ñ–∞–±—Ä–∏–∫—É
```python
# src/agent/storage/weaviate_storage.py
class WeaviateStorageFactory:
    @staticmethod
    def create_vector_storage(config: StorageConfig) -> VectorStorage:
        return WeaviateVectorStorage(config)
```

### 3. –ó–∞–º–µ–Ω–∞ –Ω–∞ Redis –¥–ª—è –ø–∞–º—è—Ç–∏

#### –®–∞–≥ 1: –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Redis –≤ docker-compose.yml
```yaml
redis:
  image: redis:7-alpine
  ports:
    - "6379:6379"
  networks:
    - iriska-network
```

#### –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```yaml
environment:
  MEMORY_TYPE: "redis"
  REDIS_URL: "redis://redis:6379"
```

#### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å Redis —Ñ–∞–±—Ä–∏–∫—É
```python
# src/agent/storage/redis_storage.py
class RedisStorageFactory:
    @staticmethod
    def create_chat_memory_storage(config: StorageConfig) -> ChatMemoryStorage:
        return RedisChatMemoryStorage(config)
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä—ã |
|------------|----------|---------|
| `DB_TYPE` | –¢–∏–ø —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î | `sqlite`, `postgresql`, `mysql` |
| `VECTOR_TYPE` | –¢–∏–ø –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î | `chroma`, `weaviate`, `pinecone` |
| `MEMORY_TYPE` | –¢–∏–ø –ø–∞–º—è—Ç–∏ | `sqlite`, `redis`, `postgresql` |
| `EMBEDDING_TYPE` | –¢–∏–ø —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ | `openai`, `sentence-transformers` |

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

#### SQLite + ChromaDB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```yaml
environment:
  DB_TYPE: "sqlite"
  VECTOR_TYPE: "chroma"
  MEMORY_TYPE: "sqlite"
```

#### PostgreSQL + Weaviate
```yaml
environment:
  DB_TYPE: "postgresql"
  VECTOR_TYPE: "weaviate"
  MEMORY_TYPE: "postgresql"
```

#### MySQL + Pinecone
```yaml
environment:
  DB_TYPE: "mysql"
  VECTOR_TYPE: "pinecone"
  MEMORY_TYPE: "redis"
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ë–î

### 1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
```python
# src/agent/storage/new_db_storage.py
class NewDBRelationalStorage(RelationalStorage):
    def __init__(self, config: StorageConfig):
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
        pass

class NewDBStorageFactory:
    @staticmethod
    def create_relational_storage(config: StorageConfig) -> RelationalStorage:
        return NewDBRelationalStorage(config)
```

### 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–±—Ä–∏–∫–µ
```python
# src/agent/storage/factory.py
elif self.config.db_type == "newdb":
    factories["relational"] = NewDBStorageFactory
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤ docker-compose.yml
```yaml
newdb:
  image: newdb:latest
  # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –ª—é–±—É—é –ë–î
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ë–î
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏ –∑–∞–º–µ–Ω–µ –ë–î –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:

```python
# src/agent/storage/migrations/
class DataMigrator:
    def migrate_sqlite_to_postgresql(self):
        # –õ–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
        pass
    
    def migrate_chroma_to_weaviate(self):
        # –õ–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
        pass
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# tests/test_storage.py
def test_storage_switching():
    # –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –ë–î
    config1 = StorageConfig(db_type="sqlite")
    config2 = StorageConfig(db_type="postgresql")
    
    factory = UniversalStorageFactory(config1)
    storage1 = factory.create_relational_storage()
    
    factory = UniversalStorageFactory(config2)
    storage2 = factory.create_relational_storage()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
    assert hasattr(storage1, 'init_db')
    assert hasattr(storage2, 'init_db')
```
