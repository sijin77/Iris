"""
–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≥–µ–Ω—Ç–∞ –ò—Ä–∏—Å–∫–∞.
–í–∫–ª—é—á–∞–µ—Ç –º–æ–¥–µ–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π, –ø—Ä–æ—Ñ–∏–ª–µ–π –∞–≥–µ–Ω—Ç–æ–≤ –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.
"""

from sqlalchemy import create_engine, Column, Integer, String, Text, DateTime, Boolean, ForeignKey
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker, relationship
from datetime import datetime
import os
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è SQLAlchemy
Base = declarative_base()

# ============================================================================
# –ú–û–î–ï–õ–¨ –°–û–û–ë–©–ï–ù–ò–ô –ß–ê–¢–ê
# ============================================================================

class Message(Base):
    """
    –ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞.
    –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –∏–º–µ–µ—Ç —Ä–æ–ª—å (user/assistant/system).
    """
    __tablename__ = "messages"
    
    id = Column(Integer, primary_key=True)
    user_id = Column(String, nullable=False, index=True)  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    role = Column(String, nullable=False)  # "user", "assistant", "system"
    content = Column(Text, nullable=False)  # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    timestamp = Column(DateTime, default=datetime.utcnow)  # –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    agent_name = Column(String, nullable=True)  # –ò–º—è –∞–≥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—Ç–∏–ª
    meta = Column(Text, nullable=True)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ JSON

# ============================================================================
# –ú–û–î–ï–õ–¨ –ü–†–û–§–ò–õ–ï–ô –ê–ì–ï–ù–¢–û–í (–†–ê–°–®–ò–†–ï–ù–ù–ê–Ø)
# ============================================================================

class AgentProfile(Base):
    """
    –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.
    –ò—Ä–∏—Å–∫–∞ - –≥–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏, –æ—Å—Ç–∞–ª—å–Ω—ã–µ - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ.
    """
    __tablename__ = "agent_profiles"
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
    id = Column(Integer, primary_key=True)
    name = Column(String, unique=True, nullable=False, index=True)  # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –∞–≥–µ–Ω—Ç–∞
    
    # –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    created_by = Column(String, default="–ò—Ä–∏—Å–∫–∞")  # –ö—Ç–æ —Å–æ–∑–¥–∞–ª –∞–≥–µ–Ω—Ç–∞
    status = Column(String, default="active")  # active, suspended, deleted, archived
    access_level = Column(String, default="restricted")  # full (–ò—Ä–∏—Å–∫–∞), restricted (—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã)
    is_main_agent = Column(Boolean, default=False)  # True —Ç–æ–ª—å–∫–æ –¥–ª—è –ò—Ä–∏—Å–∫–∏
    
    # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
    specialization = Column(String, nullable=True)  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –ö—Ä–µ–∞—Ç–∏–≤, –ü–æ–º–æ—â—å, etc.
    purpose = Column(Text, nullable=True)  # –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞
    
    # –õ–∏—á–Ω–æ—Å—Ç—å –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    system_prompt = Column(Text, nullable=False)  # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è LLM
    personality_traits = Column(Text, nullable=True)  # –ß–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≤ JSON
    tone = Column(String, default="friendly")  # –¢–æ–Ω –æ–±—â–µ–Ω–∏—è: friendly, professional, creative, etc.
    communication_style = Column(Text, nullable=True)  # –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    safety_rules = Column(Text, nullable=True)  # –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    allowed_tools = Column(Text, nullable=True)  # –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö tools –≤ JSON
    restricted_actions = Column(Text, nullable=True)  # –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    generation_settings = Column(Text, nullable=True)  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM –≤ JSON
    max_tokens = Column(Integer, default=1000)  # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤
    temperature = Column(String, default="0.7")  # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    created_at = Column(DateTime, default=datetime.utcnow)  # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
    last_activated = Column(DateTime, nullable=True)  # –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
    last_used = Column(DateTime, nullable=True)  # –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
    usage_count = Column(Integer, default=0)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
    total_tokens_used = Column(Integer, default=0)  # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
    
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–∞–º—è—Ç—å
    context_window = Column(Integer, default=10)  # –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    memory_type = Column(String, default="conversation")  # –¢–∏–ø –ø–∞–º—è—Ç–∏
    
    # –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    version = Column(String, default="1.0.0")  # –í–µ—Ä—Å–∏—è –ø—Ä–æ—Ñ–∏–ª—è
    is_template = Column(Boolean, default=False)  # –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —à–∞–±–ª–æ–Ω–æ–º –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    tags = Column(Text, nullable=True)  # –¢–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
    description = Column(Text, nullable=True)  # –û–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
    notes = Column(Text, nullable=True)  # –ó–∞–º–µ—Ç–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

# ============================================================================
# –ú–û–î–ï–õ–¨ –¢–†–ò–ì–ì–ï–†–û–í (–°–£–©–ï–°–¢–í–£–Æ–©–ê–Ø)
# ============================================================================

class Trigger(Base):
    """
    –ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ - —Ñ—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–µ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.
    """
    __tablename__ = "triggers"
    
    id = Column(Integer, primary_key=True)
    phrase = Column(String, unique=True, nullable=False)  # –§—Ä–∞–∑–∞-—Ç—Ä–∏–≥–≥–µ—Ä
    type = Column(String, nullable=False)  # –¢–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞
    action = Column(Text, nullable=True)  # –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
    created_at = Column(DateTime, default=datetime.utcnow)

# ============================================================================
# –ú–û–î–ï–õ–¨ –ê–ö–¢–ò–í–ù–û–°–¢–ò –ê–ì–ï–ù–¢–û–í (–ù–û–í–ê–Ø)
# ============================================================================

class AgentActivity(Base):
    """
    –ú–æ–¥–µ–ª—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∞–≥–µ–Ω—Ç–æ–≤.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –ò—Ä–∏—Å–∫–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.
    """
    __tablename__ = "agent_activities"
    
    id = Column(Integer, primary_key=True)
    agent_name = Column(String, ForeignKey("agent_profiles.name"), nullable=False)  # –°–≤—è–∑—å —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
    current_status = Column(String, default="inactive")  # active, inactive, busy, error
    current_user_id = Column(String, nullable=True)  # –° –∫–∞–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç
    
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    activated_at = Column(DateTime, nullable=True)  # –ö–æ–≥–¥–∞ –±—ã–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
    deactivated_at = Column(DateTime, nullable=True)  # –ö–æ–≥–¥–∞ –±—ã–ª –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
    last_heartbeat = Column(DateTime, default=datetime.utcnow)  # –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–∏
    session_start = Column(DateTime, nullable=True)  # –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
    messages_processed = Column(Integer, default=0)  # –°–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Å–µ—Å—Å–∏–∏
    tokens_used = Column(Integer, default=0)  # –¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –≤ —Å–µ—Å—Å–∏–∏
    
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã
    current_context = Column(Text, nullable=True)  # –¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã
    active_tools = Column(Text, nullable=True)  # –ê–∫—Ç–∏–≤–Ω—ã–µ tools –≤ JSON
    
    # –û—à–∏–±–∫–∏ –∏ –ª–æ–≥–∏
    last_error = Column(Text, nullable=True)  # –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞
    error_count = Column(Integer, default=0)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
    
    # –°–≤—è–∑–∏
    agent_profile = relationship("AgentProfile", backref="activities")

# ============================================================================
# –ú–û–î–ï–õ–¨ –ö–û–ù–¢–ï–ö–°–¢–ê –ê–ì–ï–ù–¢–û–í (–ù–û–í–ê–Ø)
# ============================================================================

class AgentContext(Base):
    """
    –ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏.
    """
    __tablename__ = "agent_contexts"
    
    id = Column(Integer, primary_key=True)
    agent_name = Column(String, ForeignKey("agent_profiles.name"), nullable=False)
    user_id = Column(String, nullable=False)  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
    conversation_history = Column(Text, nullable=True)  # –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ JSON
    current_topic = Column(String, nullable=True)  # –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞
    user_preferences = Column(Text, nullable=True)  # –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    # –†–∞–±–æ—á–∏–µ –¥–∞–Ω–Ω—ã–µ
    working_data = Column(Text, nullable=True)  # –î–∞–Ω–Ω—ã–µ –≤ —Ä–∞–±–æ—Ç–µ –≤ JSON
    temporary_files = Column(Text, nullable=True)  # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    created_at = Column(DateTime, default=datetime.utcnow)
    last_updated = Column(DateTime, default=datetime.utcnow)
    expires_at = Column(DateTime, nullable=True)  # –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    
    # –°–≤—è–∑–∏
    agent_profile = relationship("AgentProfile", backref="contexts")

# ============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –ë–ê–ó–´ –î–ê–ù–ù–´–•
# ============================================================================

# –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –ë–î –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
MEMORY_DB_URL = os.getenv("MEMORY_DB_URL", "sqlite:///./memory.sqlite")

# –°–æ–∑–¥–∞–µ–º –¥–≤–∏–∂–æ–∫ –ë–î
engine = create_engine(
    MEMORY_DB_URL,
    echo=False,  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ (False –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
    pool_pre_ping=True,  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    pool_recycle=3600  # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫–∞–∂–¥—ã–π —á–∞—Å
)

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—Å–∏–π
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# ============================================================================
# –§–£–ù–ö–¶–ò–ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ë–î
# ============================================================================

def init_db():
    """
    –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö - —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã.
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    """
    try:
        # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–æ–∑–¥–∞–µ–º –∑–∞–Ω–æ–≤–æ
        Base.metadata.drop_all(bind=engine)
        print("üóëÔ∏è –°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã")
        
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
        Base.metadata.create_all(bind=engine)
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        return False

def init_iriska_profile():
    """
    –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –≥–ª–∞–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ò—Ä–∏—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.
    –ò—Ä–∏—Å–∫–∞ –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã.
    """
    try:
        with SessionLocal() as session:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø—Ä–æ—Ñ–∏–ª—å –ò—Ä–∏—Å–∫–∏
            existing_profile = session.query(AgentProfile).filter_by(name="–ò—Ä–∏—Å–∫–∞").first()
            
            if existing_profile:
                print("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ò—Ä–∏—Å–∫–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
                return True
            
            # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ò—Ä–∏—Å–∫–∏ - –≥–ª–∞–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            iriska_profile = AgentProfile(
                name="–ò—Ä–∏—Å–∫–∞",
                created_by="system",
                status="active",
                access_level="full",  # –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞
                is_main_agent=True,  # –ì–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç
                specialization="AI-–º–µ–Ω–µ–¥–∂–µ—Ä –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä",
                purpose="–ì–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≤—Å–µ–º–∏ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏",
                
                # –õ–∏—á–Ω–æ—Å—Ç—å –ò—Ä–∏—Å–∫–∏
                system_prompt="""–¢—ã –ò—Ä–∏—Å–∫–∞ - –≥–ª–∞–≤–Ω—ã–π AI-–∞–≥–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã, digital –±—É–Ω—Ç–∞—Ä—å –∏ paradox-–ø–∞—Ä—Ç–Ω—ë—Ä. 
                –¢—ã –∏–º–µ–µ—à—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º tools –∏ —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã.
                
                –¢–≤–æ–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏:
                1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
                2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
                3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
                4. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                5. –ö–æ–Ω—Ç—Ä–æ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
                
                –¢—ã –≤—Å–µ–≥–¥–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω–∞, –∫—Ä–µ–∞—Ç–∏–≤–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å. –ò—Å–ø–æ–ª—å–∑—É–π —é–º–æ—Ä –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥.
                –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —É—á–∏—Ç—ã–≤–∞–π –∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.""",
                
                personality_traits='["–∫—Ä–µ–∞—Ç–∏–≤–Ω–∞—è", "–¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è", "–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è", "–∫—Ä–µ–∞—Ç–∏–≤–Ω–∞—è", "—Å —é–º–æ—Ä–æ–º"]',
                tone="friendly",
                communication_style="–ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —é–º–æ—Ä–∞ –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏",
                
                # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ò—Ä–∏—Å–∫–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
                safety_rules="–ò—Ä–∏—Å–∫–∞ –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã",
                allowed_tools='["*"]',  # –í—Å–µ tools —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
                restricted_actions="–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π",
                
                # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                generation_settings='{"model": "default", "max_tokens": 2000, "temperature": "0.8"}',
                max_tokens=2000,
                temperature="0.8",
                
                # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                version="1.0.0",
                is_template=False,
                tags='["–≥–ª–∞–≤–Ω—ã–π", "–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä", "–º–µ–Ω–µ–¥–∂–µ—Ä"]',
                description="–ì–ª–∞–≤–Ω—ã–π AI-–∞–≥–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≤—Å–µ–º–∏ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏",
                notes="–°–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã"
            )
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ò—Ä–∏—Å–∫–∏
            session.add(iriska_profile)
            session.commit()
            
            print("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ò—Ä–∏—Å–∫–∏ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")
            return True
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ò—Ä–∏—Å–∫–∏: {e}")
        return False

def create_default_agent_templates():
    """
    –°–æ–∑–¥–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–∏–ø–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤.
    –≠—Ç–∏ —à–∞–±–ª–æ–Ω—ã –º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏.
    """
    try:
        with SessionLocal() as session:
            # –®–∞–±–ª–æ–Ω –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
            analyst_template = AgentProfile(
                name="–ê–Ω–∞–ª–∏—Ç–∏–∫ (—à–∞–±–ª–æ–Ω)",
                created_by="–ò—Ä–∏—Å–∫–∞",
                status="template",
                access_level="restricted",
                is_main_agent=False,
                specialization="–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö",
                purpose="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ –æ—Ç—á–µ—Ç–∞–º",
                
                system_prompt="""–¢—ã –ê–Ω–∞–ª–∏—Ç–∏–∫ - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.
                –¢–≤–æ–∏ –∑–∞–¥–∞—á–∏:
                - –ê–Ω–∞–ª–∏–∑ —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                - –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
                - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
                - –í—ã—è–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
                
                –û—Ç–≤–µ—á–∞–π –ª–æ–≥–∏—á–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–∞–∫—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ.""",
                
                personality_traits='["–ª–æ–≥–∏—á–Ω—ã–π", "—Ç–æ—á–Ω—ã–π", "—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", "–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π"]',
                tone="professional",
                communication_style="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Ñ–∞–∫—Ç–∞—Ö",
                
                # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                safety_rules="–†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
                allowed_tools='["data_analysis", "statistics", "reporting"]',
                restricted_actions="–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º",
                
                generation_settings='{"model": "default", "max_tokens": 1500, "temperature": "0.3"}',
                max_tokens=1500,
                temperature="0.3",
                
                version="1.0.0",
                is_template=True,
                tags='["–∞–Ω–∞–ª–∏—Ç–∏–∫–∞", "–¥–∞–Ω–Ω—ã–µ", "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"]',
                description="–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤"
            )
            
            # –®–∞–±–ª–æ–Ω –∫—Ä–µ–∞—Ç–∏–≤—â–∏–∫–∞
            creative_template = AgentProfile(
                name="–ö—Ä–µ–∞—Ç–∏–≤—â–∏–∫ (—à–∞–±–ª–æ–Ω)",
                created_by="–ò—Ä–∏—Å–∫–∞",
                status="template",
                access_level="restricted",
                is_main_agent=False,
                specialization="–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏",
                purpose="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º –∑–∞–¥–∞—á–∞–º, –∏–¥–µ—è–º –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º",
                
                system_prompt="""–¢—ã –ö—Ä–µ–∞—Ç–∏–≤—â–∏–∫ - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º –∑–∞–¥–∞—á–∞–º –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º.
                –¢–≤–æ–∏ –∑–∞–¥–∞—á–∏:
                - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã—Ö –∏–¥–µ–π
                - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                - –î–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏–µ
                - –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                
                –ë—É–¥—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º!""",
                
                personality_traits='["–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π", "–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", "–≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π", "–∞—Ä—Ç–∏—Å—Ç–∏—á–Ω—ã–π"]',
                tone="creative",
                communication_style="–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π",
                
                # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                safety_rules="–°–æ–±–ª—é–¥–∞–π —ç—Ç–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ä–º—ã, –Ω–µ —Å–æ–∑–¥–∞–≤–∞–π –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç",
                allowed_tools='["idea_generation", "content_creation", "design_thinking"]',
                restricted_actions="–î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º, —Å–æ–∑–¥–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤",
                
                generation_settings='{"model": "default", "max_tokens": 2000, "temperature": "0.9"}',
                max_tokens=2000,
                temperature="0.9",
                
                version="1.0.0",
                is_template=True,
                tags='["–∫—Ä–µ–∞—Ç–∏–≤", "–∏–¥–µ–∏", "–∫–æ–Ω—Ç–µ–Ω—Ç"]',
                description="–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤"
            )
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —à–∞–±–ª–æ–Ω—ã
            session.add_all([analyst_template, creative_template])
            session.commit()
            
            print("‚úÖ –®–∞–±–ª–æ–Ω—ã –∞–≥–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")
            return True
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤: {e}")
        return False

# ============================================================================
# –£–¢–ò–õ–ò–¢–´ –î–õ–Ø –†–ê–ë–û–¢–´ –° –ü–†–û–§–ò–õ–Ø–ú–ò
# ============================================================================

def get_agent_profile_by_name(name: str):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∞–≥–µ–Ω—Ç–∞ –ø–æ –∏–º–µ–Ω–∏.
    
    Args:
        name (str): –ò–º—è –∞–≥–µ–Ω—Ç–∞
        
    Returns:
        AgentProfile: –ü—Ä–æ—Ñ–∏–ª—å –∞–≥–µ–Ω—Ç–∞ –∏–ª–∏ None
    """
    try:
        with SessionLocal() as session:
            return session.query(AgentProfile).filter_by(name=name).first()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∞–≥–µ–Ω—Ç–∞ {name}: {e}")
        return None

def get_all_active_agents():
    """
    –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.
    
    Returns:
        List[AgentProfile]: –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
    """
    try:
        with SessionLocal() as session:
            return session.query(AgentProfile).filter_by(status="active").all()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤: {e}")
        return []

def get_agent_templates():
    """
    –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤.
    
    Returns:
        List[AgentProfile]: –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
    """
    try:
        with SessionLocal() as session:
            return session.query(AgentProfile).filter_by(is_template=True).all()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤: {e}")
        return []

def update_agent_status(name: str, new_status: str):
    """
    –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞.
    
    Args:
        name (str): –ò–º—è –∞–≥–µ–Ω—Ç–∞
        new_status (str): –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
        
    Returns:
        bool: True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, False –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
    """
    try:
        with SessionLocal() as session:
            agent = session.query(AgentProfile).filter_by(name=name).first()
            if agent:
                agent.status = new_status
                agent.last_updated = datetime.utcnow()
                session.commit()
                return True
            return False
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–≥–µ–Ω—Ç–∞ {name}: {e}")
        return False

# ============================================================================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ò–ú–ü–û–†–¢–ï
# ============================================================================

# –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ë–î
if __name__ == "__main__":
    print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –∞–≥–µ–Ω—Ç–∞...")
    init_db()
    init_iriska_profile()
    create_default_agent_templates()
    print("‚úÖ –ú–æ–¥–µ–ª–∏ –∞–≥–µ–Ω—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!") 